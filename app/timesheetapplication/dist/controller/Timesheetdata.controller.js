sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageBox"],function(e,t,o,a){"use strict";var s=this;return e.extend("timesheetapplication.controller.Timesheetdata",{onInit:function(){this.array=[];s.oGmodel=this.getOwnerComponent().getModel("oGmodel");this.getOwnerComponent().getRouter().getRoute("Timesheetdata").attachPatternMatched(this._onPatternMatched,this)},_onPatternMatched:function(){s.oGmodel=this.getOwnerComponent().getModel("oGmodel");if(!s.oGmodel.oData["loggedInUser"]){this.getOwnerComponent().getRouter().navTo("RouteView");return}this.byId("FullName").setText(s.oGmodel.oData.loggedInUser.FullName);var e=new t({array:s.oGmodel.oData.odata.FULLNAME});this.getView().byId("usersComboBox").setModel(e);this.getView().byId("usersComboBox").setSelectedKey(s.oGmodel.oData.loggedInUser.Email);var o=s.oGmodel.oData.odata.EMPLOYEEID;this.onFetchTimesheetData(o);if(!s.oGmodel.oData["loggedInUser"]){this.getOwnerComponent().getRouter().navTo("RouteView");return}if(s.oGmodel.oData.odata.MANAGERFLAG==="No"){this.getView().byId("NewTimeSheet").setVisible(true);this.getView().mAggregations.content[0].mAggregations.footer.removeStyleClass("classFooterHidden").addStyleClass("classFooterVisible");this.getView().byId("usersComboBox").setVisible(false)}else{this.getView().mAggregations.content[0].mAggregations.footer.removeStyleClass("classFooterVisible").addStyleClass("classFooterHidden");this.getView().byId("NewTimeSheet").setVisible(false);this.getView().byId("usersComboBox").setVisible(true)}},onFetchTimesheetData:function(e){var t=this.getOwnerComponent().getModel("oModel");var o={empid:e};t.callFunction("/TimeSheetdata",{method:"GET",urlParameters:o,success:function(e){try{var t=JSON.parse(e.TimeSheetdata);if(t&&t.length>0){var o=new sap.ui.model.json.JSONModel;o.setData({timesheetData:t});this.getView().setModel(o,"timesheetModel");var o=new sap.ui.model.json.JSONModel;var a=[...new Set(t.map(e=>e.EMPLOYEENAME))];var s=new sap.ui.model.json.JSONModel;s.setData({employees:a.map(e=>({name:e}))});this.getView().setModel(s,"employeeModel")}else{sap.m.MessageToast.show("No timesheet data avalible")}}catch(e){sap.m.MessageBox.error("No timesheet data avalible")}}.bind(this),error:function(e){sap.m.MessageBox.error("An error occurred while fetching timesheet data.")}})},onSelectusername:function(e){var t=e.getSource().getSelectedItem()?e.getSource().getSelectedItem().getKey():"";var o=this.getView().byId("timesheetTable");var a=o.getBinding("items");if(t===""){a.filter([])}else{var s=new sap.ui.model.Filter("EMPLOYEENAME",sap.ui.model.FilterOperator.EQ,t);a.filter([s])}},onBefore:function(){if(true){sap.m.MessageBox.confirm("You have unsaved changes. Do you want to proceed without saving?",{actions:[a.Action.YES,a.Action.NO],onClose:function(e){if(e===a.Action.YES){this.getOwnerComponent().getRouter().navTo("RouteView")}else{}}.bind(this)})}},oncreatenewtimesheet:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var t="D";var o="E";var a="ST";var s="SB";var i="DT";e.navTo("NewTimesheet",{dateRange:t,Status:a,Name:o,submit:s,Sdate:i})},onRowPress:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);var o=e.getSource().getBindingContext("timesheetModel").getObject();var a=o.EMPLOYEENAME;var s=o.PERIOD;var i=o.STATUS;var n=o.SUBMITTEDBY;var r=o.DATE;t.navTo("NewTimesheet",{dateRange:s,Status:i,Name:a,submit:n,Sdate:r})},onHomePress:function(){this.getOwnerComponent().getRouter().navTo("RouteView")},CustomerHeader:function(e){var t=e.getSource(),a=this.getView();var i=this.getOwnerComponent().getModel("oGmodel");s.Email=i.oData["loggedInUser"].Email;s.FullName=i.oData["loggedInUser"].FullName;if(!this._Logoutpopover){this._Logoutpopover=o.load({id:a.getId(),name:"timesheetapplication.Fragments.Headericon",controller:this}).then(function(e){a.addDependent(e);a.byId("title").setText(s.FullName);a.byId("email").setText(s.Email);return e})}this._Logoutpopover.then(function(e){a.byId("title").setText(s.FullName);a.byId("email").setText(s.Email);if(e.isOpen()){e.close()}else{e.openBy(t)}})},HandleSignout:function(){this.getOwnerComponent().getRouter().navTo("RouteView");this.byId("emailInput").setValue("");this.byId("passwordInput").setValue("")}})});
//# sourceMappingURL=Timesheetdata.controller.js.map